{"ast":null,"code":"import _objectSpread from \"/home/academy9/\\u0414\\u043E\\u043A\\u0443\\u043C\\u0435\\u043D\\u0442\\u044B/MobX/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";\nimport _applyDecoratedDescriptor from \"/home/academy9/\\u0414\\u043E\\u043A\\u0443\\u043C\\u0435\\u043D\\u0442\\u044B/MobX/node_modules/@babel/runtime/helpers/esm/applyDecoratedDescriptor.js\";\nvar _class;\nimport { makeAutoObservable, action } from \"mobx\";\nimport { updateTask, handleAddTask, fetchTasks as apiFetchTasks } from \"../api\";\nconst saveTasksToLocalStorage = tasks => {\n  localStorage.setItem(\"tasks\", JSON.stringify(tasks));\n};\nconst getTasksFromLocalStorage = () => {\n  const savedTasks = localStorage.getItem(\"tasks\");\n  try {\n    return savedTasks ? JSON.parse(savedTasks) : [];\n  } catch (error) {\n    console.error(\"Error parsing saved tasks:\", error);\n    return [];\n  }\n};\nlet TodoStore = (_class = class TodoStore {\n  constructor() {\n    this.tasks = [];\n    this.newTaskText = \"\";\n    this.editingTask = null;\n    this.message = \"\";\n    makeAutoObservable(this);\n  }\n  async fetchInitialTasks() {\n    try {\n      const fetchedTasks = await apiFetchTasks();\n      const savedTasks = localStorage.getItem(\"tasks\");\n      let updatedTasks = [];\n      if (savedTasks) {\n        try {\n          const parsedSavedTasks = JSON.parse(savedTasks);\n          const allTasks = [...parsedSavedTasks, ...fetchedTasks];\n          const uniqueIds = new Set();\n          updatedTasks = allTasks.filter(task => {\n            if (!uniqueIds.has(task.id)) {\n              uniqueIds.add(task.id);\n              return true;\n            }\n            return false;\n          });\n          this.message = \"❗Tasks loaded from server❗\";\n        } catch (error) {\n          console.error(\"Error parsing saved tasks:\", error);\n          updatedTasks = fetchedTasks;\n          this.message = \"❗Error parsing saved tasks. Tasks loaded from server❗\";\n        }\n      } else {\n        updatedTasks = fetchedTasks;\n        this.message = \"❗Tasks loaded from server❗\";\n      }\n      saveTasksToLocalStorage(updatedTasks);\n      this.tasks = updatedTasks;\n    } catch (error) {\n      console.error(\"Error fetching tasks:\", error);\n      this.tasks = getTasksFromLocalStorage();\n      this.message = \"❗Error loading tasks. Tasks loaded from local storage❗\";\n    }\n    ;\n  }\n  addTask() {\n    if (!this.newTaskText.trim()) return;\n    handleAddTask(this.newTaskText).then(newTask => {\n      this.tasks.push(newTask);\n      saveTasksToLocalStorage(this.tasks);\n      this.newTaskText = \"\";\n    });\n  }\n  deleteTask(id) {\n    this.tasks = this.tasks.filter(task => task.id !== id);\n    saveTasksToLocalStorage(this.tasks);\n  }\n  toggleTask(id) {\n    const taskIndex = this.tasks.findIndex(task => task.id === id);\n    if (taskIndex !== -1) {\n      this.tasks[taskIndex].completed = !this.tasks[taskIndex].completed;\n      saveTasksToLocalStorage(this.tasks);\n    }\n  }\n  markAllCompleted() {\n    this.tasks = this.tasks.map(task => _objectSpread(_objectSpread({}, task), {}, {\n      completed: true\n    }));\n    saveTasksToLocalStorage(this.tasks);\n  }\n  deleteCompleted() {\n    this.tasks = this.tasks.filter(task => !task.completed);\n    saveTasksToLocalStorage(this.tasks);\n  }\n  startEditingTask(task) {\n    this.editingTask = task;\n  }\n  cancelEditingTask() {\n    this.editingTask = null;\n  }\n  updateTaskInStore(updatedTask) {\n    if (updatedTask.text.trim() === \"\") return;\n    const taskIndex = this.tasks.findIndex(task => task.documentId === updatedTask.documentId);\n    if (taskIndex !== -1) {\n      updateTask(updatedTask.documentId, updatedTask.completed, updatedTask.text).then(() => {\n        this.tasks[taskIndex] = updatedTask;\n        saveTasksToLocalStorage(this.tasks);\n      });\n    }\n    this.editingTask = null;\n  }\n  setNewTaskText(text) {\n    this.newTaskText = text;\n  }\n}, _applyDecoratedDescriptor(_class.prototype, \"updateTaskInStore\", [action], Object.getOwnPropertyDescriptor(_class.prototype, \"updateTaskInStore\"), _class.prototype), _class);\nexport default new TodoStore();","map":{"version":3,"names":["makeAutoObservable","action","updateTask","handleAddTask","fetchTasks","apiFetchTasks","saveTasksToLocalStorage","tasks","localStorage","setItem","JSON","stringify","getTasksFromLocalStorage","savedTasks","getItem","parse","error","console","TodoStore","_class","constructor","newTaskText","editingTask","message","fetchInitialTasks","fetchedTasks","updatedTasks","parsedSavedTasks","allTasks","uniqueIds","Set","filter","task","has","id","add","addTask","trim","then","newTask","push","deleteTask","toggleTask","taskIndex","findIndex","completed","markAllCompleted","map","_objectSpread","deleteCompleted","startEditingTask","cancelEditingTask","updateTaskInStore","updatedTask","text","documentId","setNewTaskText","_applyDecoratedDescriptor","prototype","Object","getOwnPropertyDescriptor"],"sources":["/home/academy9/Документы/MobX/src/store/todoStore.ts"],"sourcesContent":["import { makeAutoObservable, action } from \"mobx\";\nimport { TaskItem } from \"../types\";\nimport { updateTask, handleAddTask, fetchTasks as apiFetchTasks } from \"../api\";\n\nconst saveTasksToLocalStorage = (tasks: TaskItem[]): void => {\n    localStorage.setItem(\"tasks\", JSON.stringify(tasks));\n};\n\nconst getTasksFromLocalStorage = (): TaskItem[] => {\n    const savedTasks = localStorage.getItem(\"tasks\");\n    try {\n        return savedTasks ? JSON.parse(savedTasks) : [];\n    } catch (error) {\n        console.error(\"Error parsing saved tasks:\", error);\n        return [];\n    }\n};\n\n\nclass TodoStore {\n    tasks: TaskItem[] = [];\n    newTaskText: string = \"\";\n    editingTask: TaskItem | null = null;\n    message: string = \"\";\n    \n\n    constructor() {\n        makeAutoObservable(this);\n    }\n\n\n    async fetchInitialTasks() {\n        try {\n            const fetchedTasks = await apiFetchTasks();\n            const savedTasks = localStorage.getItem(\"tasks\");\n            let updatedTasks: TaskItem[] = [];\n\n            if (savedTasks) {\n                try {\n                    const parsedSavedTasks = JSON.parse(savedTasks);\n                    const allTasks = [...parsedSavedTasks, ...fetchedTasks];\n                    const uniqueIds = new Set<number>();\n                    updatedTasks = allTasks.filter((task) => {\n                        if (!uniqueIds.has(task.id)) {\n                            uniqueIds.add(task.id);\n                            return true;\n                        }\n                        return false;\n                    });\n                    this.message = \"❗Tasks loaded from server❗\";\n                } catch (error) {\n                    console.error(\"Error parsing saved tasks:\", error);\n                    updatedTasks = fetchedTasks;\n                    this.message = \"❗Error parsing saved tasks. Tasks loaded from server❗\";\n                }\n            } else {\n                updatedTasks = fetchedTasks;\n                this.message = \"❗Tasks loaded from server❗\";\n            }\n\n            saveTasksToLocalStorage(updatedTasks);\n            this.tasks = updatedTasks;\n        } catch (error) {\n            console.error(\"Error fetching tasks:\", error);\n            this.tasks = getTasksFromLocalStorage();\n            this.message = \"❗Error loading tasks. Tasks loaded from local storage❗\";\n        };\n    }\n    \n\n\naddTask() {\n  if (!this.newTaskText.trim()) return;\n\n  handleAddTask(this.newTaskText).then((newTask) => {\n    this.tasks.push(newTask);\n    saveTasksToLocalStorage(this.tasks);\n    this.newTaskText = \"\";\n  });\n}\n\n    deleteTask(id: number) {\n        this.tasks = this.tasks.filter((task) => task.id !== id);\n        saveTasksToLocalStorage(this.tasks);\n    }\n\n    toggleTask(id: number) {\n        const taskIndex = this.tasks.findIndex((task) => task.id === id);\n        if (taskIndex !== -1) {\n            this.tasks[taskIndex].completed = !this.tasks[taskIndex].completed;\n            saveTasksToLocalStorage(this.tasks);\n        }\n    }\n    \n\n\n    markAllCompleted() {\n        this.tasks = this.tasks.map((task) => ({ ...task, completed: true }));\n        saveTasksToLocalStorage(this.tasks);\n    }\n\n    deleteCompleted() {\n        this.tasks = this.tasks.filter((task) => !task.completed);\n        saveTasksToLocalStorage(this.tasks);\n    }\n\n    startEditingTask(task: TaskItem) {\n        this.editingTask = task;\n    }\n\n    cancelEditingTask() {\n        this.editingTask = null;\n    }\n\n    @action\n    updateTaskInStore(updatedTask: TaskItem) {\n        if (updatedTask.text.trim() === \"\") return;\n      \n        const taskIndex = this.tasks.findIndex((task) => task.documentId === updatedTask.documentId);\n        if (taskIndex !== -1) {\n          updateTask(updatedTask.documentId, updatedTask.completed, updatedTask.text).then(() => {\n            this.tasks[taskIndex] = updatedTask;\n            saveTasksToLocalStorage(this.tasks);\n          });\n        }\n      \n        this.editingTask = null;\n      }\n\n      setNewTaskText(text: string) {\n        this.newTaskText = text;\n      }\n\n}\n\n\nexport default new TodoStore();"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}